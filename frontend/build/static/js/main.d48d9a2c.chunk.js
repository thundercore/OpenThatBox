(this["webpackJsonptt-miner"]=this["webpackJsonptt-miner"]||[]).push([[0],{176:function(e){e.exports=JSON.parse('{"a":[{"constant":true,"inputs":[],"name":"seed","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"size","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"playerPositions","outputs":[{"internalType":"uint256","name":"total","type":"uint256"},{"internalType":"uint256","name":"x","type":"uint256"},{"internalType":"uint256","name":"y","type":"uint256"},{"internalType":"bool","name":"initialized","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"state","outputs":[{"internalType":"enum Miner.GameState","name":"","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_size","type":"uint256"},{"internalType":"bytes32","name":"_seed","type":"bytes32"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"endBlock","type":"uint256"}],"name":"GameStarted","type":"event"},{"anonymous":false,"inputs":[],"name":"GameEnded","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"playerAddress","type":"address"},{"indexed":false,"internalType":"uint256","name":"positionX","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"positionY","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"total","type":"uint256"}],"name":"PlayerMoved","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"playerAddress","type":"address"},{"indexed":false,"internalType":"uint256","name":"positionX","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"positionY","type":"uint256"}],"name":"PlayerJoined","type":"event"},{"constant":false,"inputs":[{"internalType":"uint256","name":"_blocksUntilEnd","type":"uint256"}],"name":"startGame","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":false,"inputs":[],"name":"joinGame","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"internalType":"enum Miner.Direction","name":"_direction","type":"uint8"}],"name":"move","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"}]}')},180:function(e,t,n){e.exports=n.p+"static/media/box-closed.3f0598f3.png"},196:function(e,t,n){e.exports=n(366)},202:function(e,t){},206:function(e,t){},235:function(e,t){},237:function(e,t){},366:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(14),s=n.n(i),c=n(398),o=n(401),u=n(20),l=n(83),d=n(113),p=n(82),m=n(90),f=r.a.createContext({setCode:function(e){},provider:new d.JsonRpcProvider(""),address:"",isValid:!1,signer:void 0});function y(e){var t=e.children,n=e.rpcUrl,i=Object(a.useState)((function(){var e=new d.JsonRpcProvider(n);return e.pollingInterval=300,e})),s=Object(u.a)(i,1)[0],c=Object(a.useState)(),o=Object(u.a)(c,2),y=o[0],h=o[1],b=Object(a.useState)(!0),v=Object(u.a)(b,2),g=v[0],x=v[1];return Object(a.useEffect)((function(){y&&(x(!0),y.getBalance().then((function(e){x(e.gt(Object(m.bigNumberify)(0)))})))}),[y]),console.log(y&&y.address),r.a.createElement(f.Provider,{value:{provider:s,signer:y,isValid:g,address:y?y.address.toLowerCase():"",setCode:function(e){var t=Object(p.fromSeed)(Object(m.sha256)("0x"+Object(m.toUtf8Bytes)(e).join("")));h(new l.Wallet(t).connect(s))}}},t)}var h=function(){return Object(a.useContext)(f)},b="https://mainnet-rpc.thundercore.com",v="0x03c03E4a776fF83664a99417e470EE8cD7726c27",g=n(402),x=n(403),O=n(404),j=n(410),w=n(185),k=n(84),E=r.a.memo((function(e){var t=e.address,n=e.color,i=e.spot,s=Object(w.a)(e,["address","color","spot"]),c=Object(a.useMemo)((function(){return k({seed:t,color:n,bgcolor:"#00000000",size:6,scale:4,spotcolor:i?void 0:"#00000000"}).toDataURL()}),[t]);return r.a.createElement("img",Object.assign({},s,{src:c}))})),U=Object(c.a)((function(e){return Object(o.a)({container:{justifyContent:"space-between"}})})),M=r.a.memo((function(e){var t=U(e),n=h(),a=n.address,i=n.isValid;return r.a.createElement(g.a,{position:"relative"},r.a.createElement(x.a,{className:t.container},r.a.createElement(O.a,{variant:"h6",className:t.title},"Open That Box"),a&&i&&r.a.createElement(j.a,{display:"flex",alignItems:"center"},r.a.createElement(j.a,{mr:1},r.a.createElement(O.a,null,a.slice(0,10),"...")),r.a.createElement(E,{spot:!0,address:a,height:24,width:24,color:"black"}))))})),L=n(176),z=r.a.createContext({isLoading:!1,error:!1});function C(e){var t=Object(a.useState)(),n=Object(u.a)(t,2),i=n[0],s=n[1],c=Object(a.useState)(!1),o=Object(u.a)(c,2),d=o[0],p=o[1],m=Object(a.useState)(!1),f=Object(u.a)(m,2),y=f[0],b=f[1],v=e.contractAddress,g=h(),x=g.signer;g.provider;return Object(a.useEffect)((function(){if(v&&x){p(!0),b(!1);try{new l.Contract(v,L.a,x).deployed().then((function(e){p(!1),s(e)})).catch((function(e){console.log(e),p(!1),b(!0),s(void 0)}))}catch(e){p(!1),b(!0),s(void 0)}}}),[x,v]),r.a.createElement(z.Provider,{value:{contract:i,isLoading:d,error:y}},e.children)}var T=function(){return Object(a.useContext)(z)},P=n(408),S=n(411),I=Object(c.a)((function(e){return Object(o.a)({})})),D=r.a.memo((function(e){I(e);var t=h(),n=t.setCode,i=t.isValid,s=t.address,c=T(),o=c.contract,l=c.isLoading,d=Object(a.useState)(""),p=Object(u.a)(d,2),m=p[0],f=p[1];return i&&s&&!!o?r.a.createElement("div",null,e.children):r.a.createElement(j.a,{display:"flex",pt:8,alignItems:"center",justifyContent:"center"},r.a.createElement(j.a,{mr:2,width:400},r.a.createElement(P.a,{fullWidth:!0,color:"inherit",variant:"filled",error:!!s&&!i,onChange:function(e){return f(e.target.value)},label:s&&!i?"Invalid Code":"Code"})),r.a.createElement(S.a,{color:"primary",variant:"contained",disabled:l,onClick:function(){n(m)}},"Login"))})),R=n(406),A=n(177),B=n(27),N=n.n(B),H=n(55),J=n(178),X=n(179);function Y(e,t,n,a,r){return{address:e.toLowerCase(),x:t.toNumber(),y:n.toNumber(),total:r?r.toNumber():0,initialized:!0}}var G,W,V=n(409);function _(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function F(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_(n,!0).forEach((function(t){Object(A.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}!function(e){e[e.Unmined=0]="Unmined",e[e.Mined=1]="Mined",e[e.Treasure=2]="Treasure"}(G||(G={})),function(e){e[e.Left=0]="Left",e[e.Right=1]="Right",e[e.Down=2]="Down",e[e.Up=3]="Up"}(W||(W={}));var q=function(){function e(t,n){var a=this;Object(J.a)(this,e),this.contract=t,this.address=n,this.isMoving=!1,this.size=0,this.stateUpdate=new V.a,this.currentUser={image:"",total:0,x:0,y:0,address:"fake",initialized:!1},this.characters={},this.gameState=0,this.map=[],this.getCurrentUser=Object(H.a)(N.a.mark((function e(){var t;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.contract.playerPositions(a.address);case 2:return t=e.sent,e.abrupt("return",{x:t.x.toNumber(),y:t.y.toNumber(),total:t.total.toNumber(),initialized:t.initialized});case 4:case"end":return e.stop()}}),e)})))}return Object(X.a)(e,[{key:"createImage",value:function(e,t){return k({seed:e,color:"black",bgcolor:"#00000000",size:6,scale:4,spotcolor:t?void 0:"#00000000"}).toDataURL()}},{key:"initialize",value:function(){var e=Object(H.a)(N.a.mark((function e(){var t,n,a,r,i,s;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([this.getCurrentUser(),this.contract.size(),this.contract.state()]);case 2:if(t=e.sent,n=Object(u.a)(t,3),a=n[0],r=n[1],i=n[2],this.size=r.toNumber(),this.map=this.makeMap(this.size),this.currentUser=F({address:this.address,image:this.createImage(this.address,!0)},a),this.currentUser.initialized){e.next=24;break}return e.next=13,this.contract.joinGame();case 13:return s=e.sent,e.next=16,s.wait();case 16:return e.t0=F,e.t1={},e.t2=this.currentUser,e.t3={},e.next=22,this.getCurrentUser();case 22:e.t4=e.sent,this.currentUser=(0,e.t0)(e.t1,e.t2,e.t3,e.t4);case 24:return this.map[this.currentUser.x][this.currentUser.y]=G.Mined,this.gameState=i,e.next=28,this.loadHistoricalData();case 28:this.watchMovement();case 29:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"makeMap",value:function(e){return Array(e).fill(G.Unmined).map((function(t){return Array(e).fill(G.Unmined)}))}},{key:"watchMovement",value:function(){var e=this,t=function(t,n,a,r,i){var s=Y(t=t.toLowerCase(),n,a,0,i);t!==e.address?(e.characters[t]=F({},s,{image:e.characters[t]?e.characters[t].image:e.createImage(t)}),e.map[s.x][s.y]=G.Mined):e.currentUser.total=s.total,e.stateUpdate.next()};this.contract.on("PlayerJoined",t),this.contract.on("PlayerMoved",t)}},{key:"loadHistoricalData",value:function(){var e=Object(H.a)(N.a.mark((function e(){var t,n,a,r=this;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=F({},this.contract.filters.PlayerJoined(),{fromBlock:"0x0",toBlock:"latest"}),n=F({},this.contract.filters.PlayerMoved(),{fromBlock:"0x0",toBlock:"latest"}),e.next=4,this.contract.provider.getLogs(t);case 4:return a=e.sent,e.t0=a,e.next=8,this.contract.provider.getLogs(n);case 8:e.t1=e.sent,e.t0.concat.call(e.t0,e.t1).forEach((function(e){var t=r.contract.interface.parseLog(e).values,n=t[0].toLowerCase(),a=F({},Y(n,t[1],t[2],t[3],t[4]));n!==r.address&&(r.characters[n]=F({},a,{image:r.createImage(n)})),r.map[a.x][a.y]=G.Mined}));case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"canMove",value:function(e,t){return e>=0&&t>=0&&e<this.size&&t<this.size&&Math.abs(this.currentUser.x-e)+Math.abs(this.currentUser.y-t)===1}},{key:"callMove",value:function(){var e=Object(H.a)(N.a.mark((function e(t){var n;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contract.move(t);case 2:return n=e.sent,e.next=5,n.wait();case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"move",value:function(){var e=Object(H.a)(N.a.mark((function e(t){var n,a,r;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("move",t),n=this.currentUser,a=n.x,r=n.y,!this.isMoving){e.next=4;break}return e.abrupt("return");case 4:if(this.isMoving=!0,e.prev=5,t!==W.Down||!this.canMove(a,r+1)){e.next=13;break}return this.currentUser.y+=.4,e.next=10,this.callMove(W.Down);case 10:this.currentUser.y=r+1,e.next=32;break;case 13:if(t!==W.Up||!this.canMove(a,r-1)){e.next=20;break}return this.currentUser.y-=.4,e.next=17,this.callMove(W.Up);case 17:this.currentUser.y=r-1,e.next=32;break;case 20:if(t!==W.Left||!this.canMove(a-1,r)){e.next=27;break}return this.currentUser.x-=.4,e.next=24,this.callMove(W.Left);case 24:this.currentUser.x=a-1,e.next=32;break;case 27:if(t!==W.Right||!this.canMove(a+1,r)){e.next=32;break}return this.currentUser.x+=.4,e.next=31,this.callMove(W.Right);case 31:this.currentUser.x=a+1;case 32:this.map[this.currentUser.x][this.currentUser.y]=G.Mined,this.isMoving=!1,e.next=41;break;case 36:e.prev=36,e.t0=e.catch(5),this.isMoving=!1,this.currentUser.y=r,this.currentUser.x=a;case 41:case"end":return e.stop()}}),e,this,[[5,36]])})));return function(t){return e.apply(this,arguments)}}()}]),e}(),$=n(180),K=n.n($),Q=Object(c.a)((function(e){return Object(o.a)({})})),Z=32,ee=r.a.memo((function(e){Q(e);var t=e.service,n=Object(a.useRef)(),i=new Image;i.src=K.a;var s=29,c=19;function o(e,n,a){var r=t.characters;Object.values(r).forEach((function(t){t.x>=n.boundsXLow&&t.x<=n.boundsXHigh&&t.y>=n.boundsYLow&&t.y<=n.boundsYHigh&&function(e,t,n){var a=new Image;a.src=t.image,e.drawImage(a,(t.x-n.x+s/2)*Z+6,(t.y-n.y+c/2)*Z+6,20,20)}(e,t,a)}))}requestAnimationFrame((function e(){if(n.current){var a=n.current.getContext("2d");a.clearRect(0,0,s*Z,c*Z);var r=t.currentUser,u=Math.round(r.x)-15<0?0:Math.round(r.x)-15,l=Math.round(r.x)+14>t.size-1?t.size-1:Math.round(r.x)+14,d=Math.round(r.y)-10<0?0:Math.round(r.y)-10,p=Math.round(r.y)+10>t.size-1?t.size-1:Math.round(r.y)+10,m={boundsXHigh:l=l>t.size-1?t.size-1:l,boundsXLow:u=u<0?0:u,boundsYHigh:p=p>t.size-1?t.size-1:p,boundsYLow:d=d<0?0:d};!function(e,n,a){for(var r=n.boundsXLow;r<=n.boundsXHigh;r++)for(var o=n.boundsYLow;o<=n.boundsYHigh;o++){var u=(r-a.x+s/2)*Z,l=(o-a.y+c/2)*Z;e.lineWidth=2,e.strokeStyle="black",e.strokeRect(u,l,Z,Z),t.map[r][o]===G.Unmined&&e.drawImage(i,u+5,l+5,20,20)}}(a,m,t.currentUser),o(a,m,t.currentUser),function(e,t){var n=new Image;n.src=t.image,e.drawImage(n,s*Z/2+6,c*Z/2+6,20,20)}(a,t.currentUser),requestAnimationFrame(e)}}));var u=r.a.useCallback((function(e){"ArrowDown"===e.key||"s"===e.key?t.move(W.Down):"ArrowUp"===e.key||"w"===e.key?t.move(W.Up):"ArrowLeft"===e.key||"a"===e.key?t.move(W.Left):"ArrowRight"!==e.key&&"d"!==e.key||t.move(W.Right)}),[t]);return Object(a.useEffect)((function(){return window.addEventListener("keydown",u),function(){window.removeEventListener("keydown",u)}}),[u]),r.a.createElement("canvas",{ref:n,width:s*Z,height:c*Z})})),te=n(181),ne=n.n(te),ae=Object(c.a)((function(e){return Object(o.a)({scoreBox:{width:200,padding:8,borderRadius:4,height:50,position:"absolute",left:0,transition:e.transitions.create("all"),border:"1px solid black  "}})})),re=r.a.memo((function(e){var t=ae(e),n=Object(a.useState)(1),i=Object(u.a)(n,2),s=(i[0],i[1]);return Object(a.useEffect)((function(){e.service.stateUpdate.subscribe((function(){s(Math.random())}))}),[e.service]),r.a.createElement("div",null,Object.values(e.service.characters).sort((function(e,t){return t.total-e.total})).slice(0,10).concat([e.service.currentUser]).sort((function(e,t){return t.total-e.total})).map((function(n,a){var i=n.address,s=n.total;return r.a.createElement(j.a,{key:i,display:"flex",alignItems:"center",className:t.scoreBox,style:{top:50*a}},r.a.createElement(j.a,{mr:2},r.a.createElement(E,{address:i,color:"black",spot:i===e.service.currentUser.address})),r.a.createElement(ne.a,{component:O.a,value:s,variant:"h6",duration:500,stepPrecision:2}))})))})),ie=(Object(c.a)((function(e){return Object(o.a)({})})),r.a.memo((function(e){var t=T().contract,n=h().address,i=Object(a.useState)(new q(t,n)),s=Object(u.a)(i,1)[0],c=Object(a.useState)(!0),o=Object(u.a)(c,2),l=o[0],d=o[1],p=Object(a.useState)(!1),m=Object(u.a)(p,2),f=m[0],y=m[1];return Object(a.useEffect)((function(){s.initialize().then((function(){return d(!1)})).catch((function(e){console.log(e),y(!0)}))}),[s]),f?r.a.createElement(O.a,null,"Please Refresh the Page and Try again"):l?r.a.createElement(j.a,{display:"flex",alignItems:"center",mt:10,justifyContent:"center"},r.a.createElement(R.a,null)):r.a.createElement(j.a,{display:"flex",mt:6,justifyContent:"center"},r.a.createElement(j.a,{width:300,mr:4,position:"relative"},r.a.createElement(re,{service:s})),r.a.createElement(j.a,null,r.a.createElement(ee,{service:s,stop:!1})))}))),se=Object(c.a)((function(e){return Object(o.a)({})})),ce=r.a.memo((function(e){se(e);return r.a.createElement(y,{rpcUrl:b},r.a.createElement(C,{contractAddress:v},r.a.createElement(M,null),r.a.createElement(D,null,r.a.createElement(ie,null))))})),oe=n(182),ue=n.n(oe);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var le=n(407),de=n(184);s.a.render(r.a.createElement(le.a,{theme:Object(de.a)({palette:{background:{default:"#edeceb"},secondary:{main:"#ffe81c"},primary:{main:"rgba(123, 239, 178, 1)"}}})},r.a.createElement(ue.a,null,r.a.createElement(ce,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[196,1,2]]]);
//# sourceMappingURL=main.d48d9a2c.chunk.js.map